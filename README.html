<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.21.2: https://docutils.sourceforge.io/" />
<title>Di0Zone проект</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 9511 2024-01-13 09:50:07Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.
Despite the name, some widely supported CSS2 features are used.

See https://docutils.sourceforge.io/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: gray; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic, pre.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="di0zone">
<h1 class="title">Di0Zone проект</h1>

<p>Проект предназначен для автоматизации рутинных повседневных задач. Основной из них является поддержание рабочего окружения в актуальном состоянии в условиях, когда приходится работать на нескольких рабочих местах, кочуя от одного к другому.</p>
<p>Установка производится в домашний каталог пользователя в следующие подкаталоги:</p>
<ul class="simple">
<li><cite>${HOME}/.local/share/Di0Zone/bin</cite> - исполняемые скрипты;</li>
<li><cite>${HOME}/.local/share/Di0Zone/lib</cite> - файлы библиотек;</li>
<li><cite>${HOME}/.config/Di0Zone</cite> - файлы конфигурации;</li>
<li><cite>${HOME}/.local/share/applications</cite> - файлы Desktop Entry File;</li>
<li><cite>${HOME}/.local/share/icons</cite> - файлы пиктограмм для Desktop Entry File;</li>
<li><cite>${HOME}/.local/share/systemd/user</cite> - файлы Systemd;</li>
<li><cite>${HOME}/.local/state/Di0Zone</cite> - файлы, образующиеся в процессе работы скриптов (протоколы, резервные копии удалённых файлов).</li>
</ul>
<p>Все файлы проекта (за исключением тех, которые идут на подмену файлов из других проектов) имеют приставку &quot;dz_&quot;, по которой их легко распознать и, при необходимости, вычистить из системы.</p>
<p>Для исполняемых файлов в каталоге <tt class="docutils literal"><span class="pre">${HOME}/.local/bin</span></tt> создаются символические ссылки, по которым их можно запускать на исполнение. Необходимо проследить, что бы данный каталог находился в переменной <tt class="docutils literal">${PATH}</tt> окружения пользователя.</p>
<p>Проект работает в окружении пользователя. В проекте задействованы механизмы freedesktop.org и systemd. Необходимы терминал alacritty, Rsync, клиент SSH и сервер с доступом по SSH, Python3.</p>
<p>Проект состоит из нескольких компонентов, описанных ниже.</p>
<div class="section" id="dz-sync">
<h1>Компонент DZ_SYNC</h1>
<p>Данный компонент является надстройкой над хорошо известной в мире Linux утилитой копирования файлов Rsync.</p>
<p>Синтаксис:</p>
<pre class="code literal-block">
dz_sync[_pull|_push].sh [&lt;каталог1&gt;[ &lt;каталог2&gt;]...]
</pre>
<p>Основная задача данного компонента - поддержание в актуальном состоянии своего рабочего окружения (по-умолчанию, внутри домашнего каталога) на нескольких компьютерах сразу. Так, например, мне приходится работать на 5-ти рабочих местах. И хотелось бы, что бы мои рабочие файлы, при переходе с места на место, приводились в идентичное состояние. Т.е., если я сделал какие-либо изменения на одном рабочем месте, то должен быть механизм, который эти изменения перенесёт на другое рабочее место, при переходе на него. Этим и занимается данный компонент проекта.</p>
<p>Синхронизация данных производится посредством сервера, который хранит текущее состояние рабочего окружения. Доступ к серверу осуществляется по протоколу SSH. На сервере для размещения синхронизируемых каталогов должен быть доступен для записи каталог <tt class="docutils literal">/srv/rsync/dz_sync</tt>.</p>
<p>Начало работы на каждом рабочем месте начинается с загрузки изменений в рабочем окружении с сервера, которые были сделаны перед уходом с другого рабочего места. По окончании работы, все сделанные изменения переносятся на сервер, и работа на другом месте начинается с их загрузки, приведя рабочее окружение в то состояние, в котором оно было оставлено на предыдущем рабочем месте.</p>
<p>Компонент состоит из скрипта <tt class="docutils literal">dz_sync.sh</tt> и конфигурационного файла <tt class="docutils literal">dz_sync.conf</tt>. Будучи запущенным, скрипт самостоятельно определяет с какого компьютера были сделаны последние изменения на сервере, и, в зависимости от этого, выбирает, следует забрать их (PULL) или отправить (PUSH). Удобство использования утилиты Rsync в том, что она самостоятельно определяет изменения в файлах и осуществляет передачу только тех, которые претерпели изменения, что значительно снижает трафик и время, затрачиваемое на синхронизацию данных.</p>
<p>Список каталогов, подлежащих синхронизации, <tt class="docutils literal">dz_sync.sh</tt> получает из конфигурационного файла (массив SYNC_LIST) или из командной строки. В каждом каталоге, отправленном на сервер, на стороне сервера создаётся файл <tt class="docutils literal">.dz_sync</tt>, в котором записана информация об имени узла, с которого производилась последняя синхронизация, время и направление синхронизации.</p>
<p>Для утилиты <tt class="docutils literal">dz_sync.sh</tt> в каталоге <tt class="docutils literal"><span class="pre">${HOME}/.local/bin</span></tt> создаётся, помимо прямой ссылки, ещё две ссылки - <tt class="docutils literal">dz_sync_pull.sh</tt> и <tt class="docutils literal">dz_sync_push.sh</tt>, которые задают конкретное направление синхронизации.</p>
<p>Работа компонента не ограничивается только синхронизацией каталогов внутри рабочего окружения. Можно сохранять каталоги и вне его, указав их в командной строке, например системные настройки из <tt class="docutils literal">/etc</tt>. Главное условие, у пользователя должны быть права на чтение сохраняемой информации. Необходимо иметь ввиду разное поведение компонента с каталогами, находящимися внутри рабочего окружения и вне его. Для первых выполняется весь комплекс синхронизации, как автоматическое определение направления, загрузка на сервер, получение с него. Каталоги же за пределами рабочего окружения могут быть только загружены на сервер. При этом на сервере они помещаются в отдельный каталог <tt class="docutils literal">_ext/имя_компьютера</tt>. Обратная загрузка с сервера запрещена. Это предохраняет файлы от изменения средствами данного компонента, что может быть опасно -- ну давайте попереназапиcываем файлы, например, в каталоге <tt class="docutils literal">/etc</tt> :-E. Не думаю, что из этого получится что-то хорошее. В лучшем случае система разграничения доступа не позволит этого сделать, в худшем можно привести систему в нерабочее состояние.</p>
<p>При синхронизации не происходит безвозвратной потери стёртых в рабочем окружении файлов. Все стёртые файлы помещаются на стороне клиента в каталог <tt class="docutils literal"><span class="pre">${HOME}/.local/state/Di0Zone/dz_sync.trash</span></tt>, на стороне сервера в каталог <tt class="docutils literal">/srv/rsync/dz_sync/_trash</tt>. Для исключения их переполнения, происходит удаление каталогов старше указанного в параметре <tt class="docutils literal">TRASH_AGE</tt> количества дней.</p>
<!-- note
Адреса сервера хранятся в конфигурационном файле в переменной ``SERVER_ADDRESSES``. -->
<p>Для интеграции в окружение рабочего стола, поставляются desktop-файлы <tt class="docutils literal">dz_sync.desktop, dz_sync_pull.desktop, dz_sync_push.desktop</tt> благодаря которым скрипт можно вызывать из контекстного меню файлового менеджера щелчком на каталоге или из основного меню. Дополнительно, ссылка на <tt class="docutils literal">dz_sync.sh</tt> устанавливается в каталог автозагрузки, что бы обеспечить запуск синхронизации при входе пользователя в систему.</p>
</div>
<div class="section" id="dz-encfs">
<h1>Компонент DZ_ENCFS</h1>
<p>В своей работе я использую Encfs для шифрования каталогов с чувствительной информацией. Данный компонент помогает управлять процессом их расшифровки и монтирования и является надстройкой над утилитой Encfs.</p>
<p>Синтаксис:</p>
<pre class="code literal-block">
dz_encfs.sh &lt;зашифрованный_каталог.enc&gt;
</pre>
<p>Требования компонента:</p>
<ul class="simple">
<li>должна быть установлена утилита Encfs;</li>
<li>зашифрованные каталоги должны быть созданы, и иметь расширение .enc;</li>
<li>монтирование расшифрованного каталога производится в каталог с тем же именем, но без расширения;</li>
<li>параметры шифрования должны быть настроены средствами самой EncFS;</li>
<li>XML файл конфигурации зашифрованного каталога должен храниться отдельно от него, иметь такое же имя, как у каталога, без расширения. Местом хранения файла установлен каталог <tt class="docutils literal"><span class="pre">${HOME}/.ssh/encfs</span></tt>.</li>
</ul>
<p>При передаче скрипту, в качестве параметра, имени зашифрованного каталога, он его расшифрует и смонтирует в каталог (точку монтирования) с таким же именем, но без расширения. В случае же, если каталог уже смонтирован, произойдёт его размонтирование и удаление точки монтирования.</p>
<p>Так же этому скрипту соответствует desktop-файл <tt class="docutils literal">dz_encfs.desktop</tt>, благодаря которому скрипт интегрируется в окружение рабочего стола, в частности, его можно вызывать из контекстного меню файлового менеджера на зашифрованном каталоге.</p>
</div>
<div class="section" id="dz-shutdown">
<h1>Компонент DZ_SHUTDOWN</h1>
<p>Главная цель этого компонента вызвать DZ_SYNC для синхронизации рабочего окружения, DZ_ENCFS для размонтирования шифрованных каталогов и выключить компьютер.</p>
<p>Синтаксис:</p>
<pre class="code literal-block">
dz_shutdown.sh
</pre>
<p>Необходимость компонента заключается в том, что, порой я, по забывчивости, уходил с рабочего места не сделав синхронизации, и, придя на другое, мог только развести руками. Вся сделанная работа оставалась на предыдущем месте и была не доступна на новом. Так что компонент можно рассматривать как эдакую &quot;защиту от дурака&quot;. Вызов DZ_SHUTDOWN удобно закрепить за горячей клавишей (у меня CTRL-ALT-Backspace) и приучить себя завершать работу её нажатием.</p>
</div>
<div class="section" id="tools">
<h1>Компонент TOOLS</h1>
<p>Данный компонент предназначен для настройки рабочего окружения. Он не устанавливает своих файлов, однако вносит изменения в конфигурации существующего программного обеспечения, что бы привести его удобное для себя состояние. Очевидно, что настройка программ под себя является, иногда, трудоёмким и длительным процессом, удачная конфигурация подбирается, порой, годами с потом, кровью и слезами, а потом вырабатывается привычка работы с ней, и работа с программой, настроенной под кого-то другого или с настройками по умолчанию, вызовет существенный дискомфорт.</p>
<p>Данный компонент не ставит задачу сохранения конфигурации всего программного обеспечения на рабочем компьютере. Оно, обычно, настраивается один раз и работает долгие годы без изменений. Однако, возникают ситуации, когда это надо делать чаще. Например, я по своей работе, в рамках тестирования, часто вынужден переустанавливать операционные системы, заводить и удалять тестовых пользователей, чистить их домашние каталоги, кочевать с одного рабочего места на другое, смотреть &quot;а что произойдёт если...&lt;далее вырезано цензурой:-)&gt;&quot;. При каждой такой манипуляции я получаю постоянно используемую мной программу Midnight Commander запущенную с чистого листа в конфигурации по умолчанию, которая мне не удобна. Время, затрачиваемое на перенастройку программы, которую приходится проводить по несколько, иногда десятков, раз в день становится существенным. Вот и возникла идея свести её к набору всего одной команды <tt class="docutils literal">make config</tt>.</p>
</div>
<div class="section" id="section-1">
<h1>Установка и удаление</h1>
<p>Установка производится командой:</p>
<pre class="code literal-block">
make install
</pre>
<p>Для удаления используется команда:</p>
<pre class="code literal-block">
make clean
</pre>
<p>При этом сохраняются файлы протоколов и конфигурационные файлы. Если нужно удалить и их, то используется команда:</p>
<pre class="code literal-block">
make purge
</pre>
<p>Все команды выполняются из каталога проекта, там, где размещён Makefile.</p>
<p>Так же можно всё удалить вручную, удалив из домашнего каталога все файлы с приставкой &quot;dz_&quot;.</p>
</div>
<div class="section" id="bags-and-features">
<h1>Bags and features</h1>
<ol class="arabic simple">
<li>Обнаружился интересный  эффект. Если какой-либо подкаталог или файл находится в списке игнорируемых (переменная <tt class="docutils literal">SYNC_FILTER</tt> в файле конфигурации <tt class="docutils literal">dz_sync.conf</tt>), то он игнорируется не только при синхронизации, но при удалении тоже! Соответственно, в процессе синхронизации, ни он, ни содержащий этот подкаталог или файл и не будет удалены. Будет получена ошибка &quot;cannot delete not-empty directory&quot;.</li>
<li>Следует отметить, что с точки зрения Rsync, синхронизация переименованного каталога или файла равносильна загрузке его на приёмную сторону вновь под новым именем и удалению того, что хранилось там под старым именем. Так что осторожнее с переименованием каталогов, содержащих большое количество файлов или больших по размеру файлов. Они будут загружаться вновь, что потребует времени.</li>
</ol>
</div>
</div>
<div class="footer">
<hr class="footer" />
Generated on: 2025-09-24 07:27 UTC.

</div>
</body>
</html>
